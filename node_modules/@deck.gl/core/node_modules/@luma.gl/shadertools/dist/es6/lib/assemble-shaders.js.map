{"version":3,"sources":["../../../src/lib/assemble-shaders.js"],"names":["VERTEX_SHADER","FRAGMENT_SHADER","resolveModules","getShaderModule","getPlatformShaderDefines","getVersionDefines","injectShader","assert","SHADER_TYPE","HOOK_FUNCTIONS","MODULE_INJECTIONS","FRAGMENT_SHADER_PROLOGUE","createShaderHook","hook","opts","trim","stage","signature","split","name","replace","Object","assign","createModuleInjection","moduleName","injection","order","shaderStage","slice","assembleShaders","gl","vs","fs","modules","assembleShader","source","type","getUniforms","assembleGetUniforms","assembleModuleMap","id","defines","inject","prologue","log","isVertex","sourceLines","glslVersion","versionLine","coreSource","indexOf","join","allDefines","forEach","module","getDefines","assembledSource","getShaderName","getShaderType","getApplicationDefines","injectStandardStubs","hookInjections","mainInjections","key","match","checkDeprecations","moduleSource","getModuleSource","injections","push","getHookFunctions","uniforms","moduleUniforms","result","shaderModule","toUpperCase","injectShaderName","count","sourceText","define","value","Number","isFinite","hookFunctions","hookName","hookFunction","header","sort","a","b","footer"],"mappings":"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","sourcesContent":["import {VERTEX_SHADER, FRAGMENT_SHADER} from './constants';\nimport {resolveModules, getShaderModule} from './resolve-modules';\nimport {getPlatformShaderDefines, getVersionDefines} from './platform-defines';\nimport injectShader from './inject-shader';\nimport {assert} from '../utils';\n/* eslint-disable max-depth, complexity */\n\nconst SHADER_TYPE = {\n  [VERTEX_SHADER]: 'vertex',\n  [FRAGMENT_SHADER]: 'fragment'\n};\n\nconst HOOK_FUNCTIONS = {\n  [VERTEX_SHADER]: {},\n  [FRAGMENT_SHADER]: {}\n};\n\nconst MODULE_INJECTIONS = {};\n\n// Precision prologue to inject before functions are injected in shader\n// TODO - extract any existing prologue in the fragment source and move it up...\nconst FRAGMENT_SHADER_PROLOGUE = `\\\nprecision highp float;\n\n`;\n\nexport function createShaderHook(hook, opts = {}) {\n  hook = hook.trim();\n  const [stage, signature] = hook.split(':');\n  const name = hook.replace(/\\(.+/, '');\n  HOOK_FUNCTIONS[stage][name] = Object.assign(opts, {signature});\n}\n\nexport function createModuleInjection(moduleName, opts) {\n  const {hook, injection, order = 0} = opts;\n  const shaderStage = hook.slice(0, 2);\n\n  MODULE_INJECTIONS[moduleName] = MODULE_INJECTIONS[moduleName] || {};\n  MODULE_INJECTIONS[moduleName][shaderStage] = MODULE_INJECTIONS[moduleName][shaderStage] || {};\n\n  assert(!MODULE_INJECTIONS[moduleName][shaderStage][hook], 'Module injection already created');\n\n  MODULE_INJECTIONS[moduleName][shaderStage][hook] = {\n    injection,\n    order\n  };\n}\n\n// Inject a list of modules\nexport function assembleShaders(gl, opts = {}) {\n  const {vs, fs} = opts;\n  const modules = resolveModules(opts.modules || []);\n  return {\n    gl,\n    vs: assembleShader(gl, Object.assign({}, opts, {source: vs, type: VERTEX_SHADER, modules})),\n    fs: assembleShader(gl, Object.assign({}, opts, {source: fs, type: FRAGMENT_SHADER, modules})),\n    getUniforms: assembleGetUniforms(modules),\n    modules: assembleModuleMap(modules)\n  };\n}\n\n// Pulls together complete source code for either a vertex or a fragment shader\n// adding prologues, requested module chunks, and any final injections.\nfunction assembleShader(\n  gl,\n  {id, source, type, modules = [], defines = {}, inject = {}, prologue = true, log}\n) {\n  assert(typeof source === 'string', 'shader source must be a string');\n\n  const isVertex = type === VERTEX_SHADER;\n\n  const sourceLines = source.split('\\n');\n  let glslVersion = 100;\n  let versionLine = '';\n  let coreSource = source;\n  // Extract any version directive string from source.\n  // TODO : keep all pre-processor statements at the begining of the shader.\n  if (sourceLines[0].indexOf('#version ') === 0) {\n    glslVersion = 300; // TODO - regexp that matches atual version number\n    versionLine = sourceLines[0];\n    coreSource = sourceLines.slice(1).join('\\n');\n  }\n\n  // Combine Module and Application Defines\n  const allDefines = {};\n  modules.forEach(module => {\n    Object.assign(allDefines, module.getDefines());\n  });\n  Object.assign(allDefines, defines);\n\n  // Add platform defines (use these to work around platform-specific bugs and limitations)\n  // Add common defines (GLSL version compatibility, feature detection)\n  // Add precision declaration for fragment shaders\n  let assembledSource = prologue\n    ? `\\\n${versionLine}\n${getShaderName({id, source, type})}\n${getShaderType({type})}\n${getPlatformShaderDefines(gl)}\n${getVersionDefines(gl, glslVersion, !isVertex)}\n${getApplicationDefines(allDefines)}\n${isVertex ? '' : FRAGMENT_SHADER_PROLOGUE}\n`\n    : `${versionLine}\n`;\n\n  // Add source of dependent modules in resolved order\n  let injectStandardStubs = false;\n  const hookInjections = {};\n  const mainInjections = {};\n\n  for (const key in inject) {\n    const injection =\n      typeof inject[key] === 'string' ? {injection: inject[key], order: 0} : inject[key];\n    if (key.match(/^(v|f)s:/)) {\n      if (key[3] === '#') {\n        mainInjections[key] = [injection];\n      } else {\n        hookInjections[key] = [injection];\n      }\n    } else {\n      // Regex injection\n      mainInjections[key] = [injection];\n    }\n  }\n\n  for (const module of modules) {\n    switch (module.name) {\n      case 'inject':\n        injectStandardStubs = true;\n        break;\n\n      default:\n        module.checkDeprecations(coreSource, log);\n        const moduleSource = module.getModuleSource(type, glslVersion);\n        // Add the module source, and a #define that declares it presence\n        assembledSource += moduleSource;\n\n        if (MODULE_INJECTIONS[module.name]) {\n          const injections = MODULE_INJECTIONS[module.name][type];\n          for (const key in injections) {\n            if (key.match(/^(v|f)s:#/)) {\n              mainInjections[key] = mainInjections[key] || [];\n              mainInjections[key].push(injections[key]);\n            } else {\n              hookInjections[key] = hookInjections[key] || [];\n              hookInjections[key].push(injections[key]);\n            }\n          }\n        }\n    }\n  }\n\n  assembledSource += getHookFunctions(type, hookInjections);\n\n  // Add the version directive and actual source of this shader\n  assembledSource += coreSource;\n\n  // Apply any requested shader injections\n  assembledSource = injectShader(assembledSource, type, mainInjections, injectStandardStubs);\n\n  return assembledSource;\n}\n\n// Returns a combined `getUniforms` covering the options for all the modules,\n// the created function will pass on options to the inidividual `getUniforms`\n// function of each shader module and combine the results into one object that\n// can be passed to setUniforms.\nfunction assembleGetUniforms(modules) {\n  return function getUniforms(opts) {\n    const uniforms = {};\n    for (const module of modules) {\n      // `modules` is already sorted by dependency level. This guarantees that\n      // modules have access to the uniforms that are generated by their dependencies.\n      const moduleUniforms = module.getUniforms(opts, uniforms);\n      Object.assign(uniforms, moduleUniforms);\n    }\n    return uniforms;\n  };\n}\n\n// Returns a map with module names as keys, resolving to their module definitions\n// The presence of a key indicates that the module is available in this program,\n// whether directly included, or through a dependency of some other module\nfunction assembleModuleMap(modules) {\n  const result = {};\n  for (const moduleName of modules) {\n    const shaderModule = getShaderModule(moduleName);\n    result[moduleName] = shaderModule;\n  }\n  return result;\n}\n\nfunction getShaderType({type}) {\n  return `\n#define SHADER_TYPE_${SHADER_TYPE[type].toUpperCase()}\n`;\n}\n\n// Generate \"glslify-compatible\" SHADER_NAME defines\n// These are understood by the GLSL error parsing function\n// If id is provided and no SHADER_NAME constant is present in source, create one\nfunction getShaderName({id, source, type}) {\n  const injectShaderName = id && typeof id === 'string' && source.indexOf('SHADER_NAME') === -1;\n  return injectShaderName\n    ? `\n#define SHADER_NAME ${id}_${SHADER_TYPE[type]}\n\n`\n    : '';\n}\n\n// Generates application defines from an object\nfunction getApplicationDefines(defines = {}) {\n  let count = 0;\n  let sourceText = '';\n  for (const define in defines) {\n    if (count === 0) {\n      sourceText += '\\n// APPLICATION DEFINES\\n';\n    }\n    count++;\n\n    const value = defines[define];\n    if (value || Number.isFinite(value)) {\n      sourceText += `#define ${define.toUpperCase()} ${defines[define]}\\n`;\n    }\n  }\n  if (count === 0) {\n    sourceText += '\\n';\n  }\n  return sourceText;\n}\n\nfunction getHookFunctions(shaderStage, hookInjections) {\n  let result = '';\n  const hookFunctions = HOOK_FUNCTIONS[shaderStage];\n  for (const hookName in hookFunctions) {\n    const hookFunction = hookFunctions[hookName];\n    result += `void ${hookFunction.signature} {\\n`;\n    if (hookFunction.header) {\n      result += `  ${hookFunction.header}`;\n    }\n    if (hookInjections[hookName]) {\n      const injections = hookInjections[hookName];\n      injections.sort((a, b) => a.order - b.order);\n      for (const injection of injections) {\n        result += `  ${injection.injection}\\n`;\n      }\n    }\n    if (hookFunction.footer) {\n      result += `  ${hookFunction.footer}`;\n    }\n    result += '}\\n';\n  }\n\n  return result;\n}\n"],"file":"assemble-shaders.js"}